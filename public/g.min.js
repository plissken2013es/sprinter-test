var Game=function(){this.url=window.URL||window.webkitURL;this.init()};Game.prototype.init=function(){kontra.init();"b t c1 c2 r k c o".split(" ").forEach(function(m){kontra.assets.images[m]=document.getElementById(m)});this.main()};
Game.prototype.main=function(){function m(a,b,c,g,d){d=d||1;b=b.toLowerCase();for(var e=0,h=b.length;e<h;e++){var Y=a,f=b[e],l=c+6*e*d,n=g,k=d,p=font[f];if(!p)throw Error("Character "+f+" is not in font");for(f=0;7>f;f++)for(var m=0;5>m;m++)p[f][m]&&Y.fillRect(m*k+l,f*k+n,k,k)}}function Z(){var a=this;d.on("match",function(){b==B&&(e=[{y:119,t:"Press space when ready"}],b=u)});d.on("count",function(){b==C&&(v=w=0,e=[{y:50,t:D[v]}],b=Q)});d.on("opp_hit",function(){b==l&&(setTimeout(function(){}.bind(a),
500),n.dx=2.2)});d.on("opp_off",function(){b==l&&(n.isOffline=!0,setTimeout(function(){n.isOffline=!1}.bind(a),1500))});d.on("opp_win",function(){b==l&&(b=q,f=null,k=[],e=[{y:50,t:"Your opponent won!"},{y:119,t:"Press space to play again"}])});d.on("end",function(){e=[{y:50,t:"Your opponent has left!"}];E=!0});d.on("disconnect",function(){e=[{y:50,t:"Connection lost!"}]});d.on("error",function(){e=[{y:50,t:"Connection error!"}]})}function R(a){b==l&&(this.ddx=-.12,.02>=this.dx&&(this.ddx=0,this.dx=
.1));if(b==q||this.isOffline)this.dx=this.ddx=0,this.x|=0;this.advance();140<=("hero"==this.name?this.x-S:this.x-T)&&b==l&&(b=q,f=null,k=[],e=[{y:50,t:"hero"==this.name?"You win!":"Your opponent won!"},{y:119,t:"Press space to play again"}],"hero"==this.name&&d.emit("win"))}function F(){if(b==q)f=null,k=[];else{x=y[g()*y.length|0];var a=(p-30)*g()|15;f=kontra.sprite({x:a,y:30,animations:U.animations});f.playAnimation("up");k=[{x:a+6,y:34,t:x,s:1.4}]}}function V(){h=kontra.sprite({x:S,y:75,dx:0,name:"hero",
animations:z[G].animations,update:R});h.playAnimation("run_slow");n=kontra.sprite({x:T,y:67,name:"enemy",animations:z[3*g()|0].animations,update:R});n.playAnimation("run_slow")}function W(a){a.preventDefault();h&&h.isOffline||(b==r&&(G=["a","s","d"].indexOf(a.key),0<=G&&(b=B,V(),e=[{y:119,t:"Waiting for opponent..."}],k=[],d=io({upgrade:!1,transports:["websocket"]}),Z())),b==u&&" "==a.key&&(b=C,e=[{y:119,t:"Watch out..."}],d.emit("ready")),b!=l||H||(a.key==x?(H=!0,f.playAnimation("down"),setTimeout(function(){F();
H=!1}.bind(this),500),h.dx=2.2,d.emit("hit")):(h.isOffline=!0,f=x=null,k=[],setTimeout(function(){h.isOffline=!1;F()}.bind(this),1500),d.emit("offline"))),b==q&&" "==a.key&&(E?(b=B,E=!1,e=[{y:119,t:"Waiting for opponent..."}],d.emit("find")):(b=C,e=[{y:119,t:"Watch out..."}],d.emit("ready")),V()))}window.font={a:[[,,!0,,],[,!0,,!0],[!0,,,,!0],[!0,,,,!0],[!0,!0,!0,!0,!0],[!0,,,,!0],[!0,,,,!0]],b:[[!0,!0,!0,!0],[!0,,,,!0],[!0,,,,!0],[!0,!0,!0,!0],[!0,,,,!0],[!0,,,,!0],[!0,!0,!0,!0]],c:[[,!0,!0,!0],
[!0,,,,!0],[!0,,,,],[!0,,,,],[!0,,,,],[!0,,,,!0],[,!0,!0,!0]],d:[[!0,!0,!0,!0],[!0,,,,!0],[!0,,,,!0],[!0,,,,!0],[!0,,,,!0],[!0,,,,!0],[!0,!0,!0,!0]],e:[[!0,!0,!0,!0,!0],[!0,,,,],[!0,,,,],[!0,!0,!0,!0],[!0,,,,],[!0,,,,],[!0,!0,!0,!0,!0]],f:[[!0,!0,!0,!0,!0],[!0,,,,],[!0,,,,],[!0,!0,!0,!0],[!0,,,,],[!0,,,,],[!0,,,,]],g:[[,!0,!0,!0],[!0,,,,!0],[!0,,,,],[!0,,,,],[!0,,!0,!0,!0],[!0,,,,!0],[,!0,!0,!0]],h:[[!0,,,,!0],[!0,,,,!0],[!0,,,,!0],[!0,!0,!0,!0,!0],[!0,,,,!0],[!0,,,,!0],[!0,,,,!0]],i:[[,!0,!0,!0],
[,,!0,,],[,,!0,,],[,,!0,,],[,,!0,,],[,,!0,,],[,!0,!0,!0]],j:[[,!0,!0,!0,!0],[,,,!0],[,,,!0],[,,,!0],[,,,!0],[!0,,,!0],[,!0,!0,,]],k:[[!0,,,,!0],[!0,,,!0],[!0,,!0,,],[!0,!0,,,],[!0,,!0,,],[!0,,,!0],[!0,,,,!0]],l:[[!0,,,,],[!0,,,,],[!0,,,,],[!0,,,,],[!0,,,,],[!0,,,,],[!0,!0,!0,!0,!0]],m:[[!0,,,,!0],[!0,!0,,!0,!0],[!0,,!0,,!0],[!0,,,,!0],[!0,,,,!0],[!0,,,,!0],[!0,,,,!0]],n:[[!0,,,,!0],[!0,,,,!0],[!0,!0,,,!0],[!0,,!0,,!0],[!0,,,!0,!0],[!0,,,,!0],[!0,,,,!0]],o:[[,!0,!0,!0],[!0,,,,!0],[!0,,,,!0],[!0,,,
,!0],[!0,,,,!0],[!0,,,,!0],[,!0,!0,!0]],p:[[!0,!0,!0,!0],[!0,,,,!0],[!0,,,,!0],[!0,!0,!0,!0],[!0,,,,],[!0,,,,],[!0,,,,]],q:[[,!0,!0,!0],[!0,,,,!0],[!0,,,,!0],[!0,,,,!0],[!0,,!0,,!0],[!0,,,!0,!0],[,!0,!0,!0,!0]],r:[[!0,!0,!0,!0],[!0,,,,!0],[!0,,,,!0],[!0,!0,!0,!0],[!0,,!0,,],[!0,,,!0],[!0,,,,!0]],s:[[,!0,!0,!0],[!0,,,,!0],[!0,,,,],[,!0,!0,!0],[,,,,!0],[!0,,,,!0],[,!0,!0,!0]],t:[[!0,!0,!0,!0,!0],[,,!0,,],[,,!0,,],[,,!0,,],[,,!0,,],[,,!0,,],[,,!0,,]],u:[[!0,,,,!0],[!0,,,,!0],[!0,,,,!0],[!0,,,,!0],[!0,
,,,!0],[!0,,,,!0],[,!0,!0,!0]],v:[[!0,,,,!0],[!0,,,,!0],[!0,,,,!0],[!0,,,,!0],[,!0,,!0],[,!0,,!0],[,,!0,,]],w:[[!0,,,,!0],[!0,,,,!0],[!0,,,,!0],[!0,,,,!0],[!0,,!0,,!0],[!0,!0,,!0,!0],[!0,,,,!0]],x:[[!0,,,,!0],[!0,,,,!0],[,!0,,!0],[,,!0,,],[,!0,,!0],[!0,,,,!0],[!0,,,,!0]],y:[[!0,,,,!0],[!0,,,,!0],[,!0,,!0],[,,!0,,],[,,!0,,],[,,!0,,],[,,!0,,]],z:[[!0,!0,!0,!0,!0],[,,,,!0],[,,,!0],[,,!0,,],[,!0,,,],[!0,,,,],[!0,!0,!0,!0,!0]],0:[[,!0,!0,!0],[!0,,,,!0],[!0,,,!0,!0],[!0,,!0,,!0],[!0,!0,,,!0],[!0,,,,!0],
[,!0,!0,!0]],1:[[,!0,!0,,],[,,!0,,],[,,!0,,],[,,!0,,],[,,!0,,],[,,!0,,],[,!0,!0,!0]],2:[[,!0,!0,!0],[!0,,,,!0],[,,,!0],[,,!0,,],[,!0,,,],[!0,,,,],[!0,!0,!0,!0,!0]],3:[[,!0,!0,!0],[!0,,,,!0],[,,,,!0],[,,!0,!0],[,,,,!0],[!0,,,,!0],[,!0,!0,!0]],4:[[,,,!0],[,,!0,!0],[,!0,,!0],[!0,,,!0],[!0,!0,!0,!0,!0],[,,,!0],[,,,!0]],5:[[!0,!0,!0,!0,!0],[!0,,,,],[!0,,,,],[!0,!0,!0,!0],[,,,,!0],[!0,,,,!0],[,!0,!0,!0]],6:[[,!0,!0,!0],[!0,,,,!0],[!0,,,,],[!0,!0,!0,!0],[!0,,,,!0],[!0,,,,!0],[,!0,!0,!0]],7:[[!0,!0,!0,!0,
!0],[,,,,!0],[,,,!0],[,,,!0],[,,!0,,],[,,!0,,],[,,!0,,]],8:[[,!0,!0,!0],[!0,,,,!0],[!0,,,,!0],[,!0,!0,!0],[!0,,,,!0],[!0,,,,!0],[,!0,!0,!0]],9:[[,!0,!0,!0],[!0,,,,!0],[!0,,,,!0],[,!0,!0,!0,!0],[,,,,!0],[!0,,,,!0],[,!0,!0,!0]]," ":[[,,,,],[,,,,],[,,,,],[,,,,],[,,,,],[,,,,],[,,,,]],",":[[,,,,],[,,,,],[,,,,],[,,,,],[,,,,],[,,!0,,],[,!0,,,]],".":[[,,,,],[,,,,],[,,,,],[,,,,],[,,,,],[,,,,],[,!0,,,]],"!":[[,,!0,,],[,,!0,,],[,,!0,,],[,,!0,,],[,,!0,,],[,,,,],[,,!0,,]],"?":[[,!0,!0,!0],[!0,,,,!0],[,,,,!0],
[,,!0,!0],[,,!0,,],[,,,,],[,,!0,,]],"@":[[,!0,!0,!0],[!0,,,!0,!0],[!0,,!0,,!0],[!0,,!0,,!0],[!0,,!0,!0],[!0,,,,],[,!0,!0,!0]],"'":[[,!0,,,],[,,!0,,],[,,,,],[,,,,],[,,,,],[,,,,],[,,,,]],"\u2082":[[,,,,],[,,,,],[,,,,],[,!0,!0,,],[,,,!0],[,,!0,,],[,!0,!0,!0]],"\u2192":[[,,,,],[,,!0,,],[,,,!0],[!0,!0,!0,!0,!0],[,,,!0],[,,!0,,],[,,,,]],"\u2190":[[,,,,],[,,!0,,],[,!0,,,],[!0,!0,!0,!0,!0],[,!0,,,],[,,!0,,],[,,,,]],"(":[[,,,!0],[,,!0,,],[,!0,,,],[,!0,,,],[,!0,,,],[,,!0,,],[,,,!0]],")":[[,!0,,,],[,,!0,,],
[,,,!0],[,,,!0],[,,,!0],[,,!0,,],[,!0,,,]],"\u21b6":[[,,!0,!0],[,!0,,,!0],[,!0,,,],[!0,!0,!0,,],[,!0,,,],[,,,,],[,,,,]],"\u21b7":[[,!0,!0,,],[!0,,,!0],[,,,!0],[,,!0,!0,!0],[,,,!0],[,,,,],[,,,,]],"/":[[,,,!0],[,,,!0],[,,!0,,],[,,!0,,],[,,!0,,],[,!0,,,],[,!0,,,]],"\u2610":[[!0,!0,!0,!0,!0],[!0,,,,!0],[!0,,,,!0],[!0,,,,!0],[!0,,,,!0],[!0,,,,!0],[!0,!0,!0,!0,!0]],"\u2611":[[!0,!0,!0,!0,!0],[!0,,,,!0],[!0,!0,,!0,!0],[!0,,!0,,!0],[!0,!0,,!0,!0],[!0,,,,!0],[!0,!0,!0,!0,!0]]};for(var r=1,B=2,u=3,C=4,Q=5,
l=6,q=7,S=20,T=28,g=Math.random,p=192,A=kontra.context,d,E=!1,b=r,G=0,h,n,I=0,J=!0,x,f,H=!1,w=0,v=0,D=["On your marks","Get set","Go!"],y="abcdefghijklmnopqrstuvwxyz".split(""),c=0;c<y.length;c++)kontra.keys.bind(y[c],W);kontra.keys.bind("space",W);var aa=kontra.sprite({x:0,y:0,image:kontra.assets.images.b}),K=kontra.sprite({x:0,y:0,image:kontra.assets.images.o}),X=kontra.sprite({x:30,y:4,image:kontra.assets.images.t,dt:0,update:function(a){this.dt+=a;this.y=8+4*Math.sin(3*this.dt)}}),U=kontra.spriteSheet({image:kontra.assets.images.k,
frameWidth:19,frameHeight:20,animations:{down:{frames:[1,0],frameRate:5,loop:!1},up:{frames:"0",frameRate:0}}}),z=[],L=[],M=[],k=[],e=[{y:66,t:"Select your runner"}],t=[[0,1,2,3,4,5,6,7],[8,9,10,11,12,13,14,15],[16,17,18,19,20,21,22,23]];for(c=0;3>c;c++){t[c]=t[c].splice(8*g()|0,8).concat(t[c]);z.push(kontra.spriteSheet({image:kontra.assets.images.c,frameWidth:16,frameHeight:20,animations:{run:{frames:t[c],frameRate:20},run_slow:{frames:t[c],frameRate:6}}}));var N=(p-60)/3*(c+1);L.push(kontra.sprite({x:N,
y:106,animations:z[c].animations}));M.push(kontra.sprite({x:N,y:80,animations:U.animations}));k.push({x:N+6,y:84,t:["A","S","D"][c],s:1.4})}var O=[];for(c=1;3>c;c++)O.push(kontra.sprite({x:p*(1+g()),y:6+32*g(),image:kontra.assets.images["c"+c],dx:-g(),update:function(){-40>this.x&&(this.x=p*(1+g()),this.y=6+32*g(),this.dx=-g());this.advance()}}));c=kontra.spriteSheet({image:kontra.assets.images.r,frameWidth:20,frameHeight:20,animations:{walkL:{frames:"0..5",frameRate:12},walkR:{frames:"6..11",frameRate:12},
idleL:{frames:[2],frameRate:0},idleR:{frames:[8],frameRate:0}}});var P=kontra.sprite({x:p*g()|0,y:100+10*g()|0,animations:c.animations,dt:0,timer:1+1*g(),walk:!1,update:function(a){this.dt+=a;if(this.dt>this.timer){this.dt=0;this.timer=1+1*g();if(!this.walk&&.8>g()){a=p*g();var b=128-20*g()-10;this.dx=0<a-this.x?.5:-.5;this.dy=0<b-this.y?.1:-.1;this.playAnimation(0<this.dx?"walkR":"walkL")}else this.playAnimation(0<this.dx?"idleR":"idleL"),this.dy=this.dx=0;this.x|=0;this.y|=0;this.walk=this.walk?
!1:!0}this.advance()}});P.playAnimation("idleL");kontra.gameLoop({update:function(a){I+=a;.4<I&&(I=0,J=!J);L.map(function(a){a.update()});M.map(function(a){a.update()});b<=u&&X.update(a);b>r&&(O.map(function(a){a.update()}),h.update(),n.update(),P.update(a),f&&f.update());b==l&&h.isOffline&&(K.x=h.x,K.y=h.y-25);b==Q&&(w+=a,1<=w&&(++v>=D.length?(b=l,F(),h.dx=.1,n.dx=.1,e=[]):(e=[{y:50,t:D[v]}],w=0)))},render:function(){b==r&&(L.map(function(a){a.render()}),M.map(function(a){a.render()}));b>r&&(aa.render(),
O.map(function(a){a.render()}),n.render(),h.render(),P.render(),f&&f.render());b==l&&h.isOffline&&K.render();b<=u&&X.render();J&&(A.fillStyle="#fff",e.map(function(a){var b=a.t;a=a.y;var c=1;b=b.toLowerCase();m(A,b,kontra.canvas.width/2-b.length/2*6*c,a,c)}));A.fillStyle="#000";k.map(function(a){m(A,a.t,a.x,a.y,a.s)})}}).start()};window.addEventListener("load",function(){new Game},!1);